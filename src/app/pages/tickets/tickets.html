<div class="tickets-page">

  <h2>Tickets</h2>

  @if (loading) {
    <p class="info">Loading data...</p>
  }

  @if (error) {
    <p class="error">{{ error }}</p>
  }

  @if (!loading && !error && occupiedSpots.length === 0) {
    <p class="info">No occupied spots at the moment.</p>
  }

  <!-- OCCUPIED SPOTS WITH PRICE PREVIEW -->
  <div class="spots-grid">
    @for (entry of occupiedSpots; track entry.spot.id) {

      <mat-card class="spot-card">

        <mat-card-header>
          <mat-card-title>{{ entry.spot.code }}</mat-card-title>
          <mat-card-subtitle>
            {{ entry.spot.type }} â€¢ Occupied
          </mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
          <p>
            <strong>Duration:</strong>
            <!-- REAL SECONDS -->
            {{ formatDuration(entry.seconds) }}
          </p>

          <p>
            <strong>Price:</strong>
            <span class="price">{{ entry.price }} LEK</span>
          </p>
        </mat-card-content>

        <button mat-raised-button color="primary" (click)="generateTicket(entry)">
          <mat-icon>receipt_long</mat-icon>
          Generate Ticket
        </button>

      </mat-card>

    }
  </div>

  <!-- GENERATED TICKETS LIST -->
  @if (generatedTickets.length > 0) {

    <h3>Generated Tickets</h3>

    <div class="tickets-grid">
      @for (t of generatedTickets; track t.id ?? t.spotCode + t.createdAt) {

        <mat-card class="ticket-card">
          <mat-card-title>Ticket #{{ t.id }}</mat-card-title>

          <p><strong>Spot:</strong> {{ t.spotCode }}</p>
          <p><strong>Duration:</strong> {{ t.durationMinutes }} min</p>
          <p><strong>Price:</strong> <span class="price">{{ t.price }} LEK</span></p>
          <p class="timestamp">
            {{ t.createdAt | date:'short' }}
          </p>
        </mat-card>

      }
    </div>

  }

</div>
